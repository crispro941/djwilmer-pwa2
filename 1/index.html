<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .fade { opacity: 0; transition: opacity 0.5s ease-in-out; }
        .show { opacity: 1; }
        .loaded { opacity: 1 !important; }
    </style>
</head>
<body class="bg-gray-900 text-white flex justify-center items-center min-h-screen relative">
    <div id="bg-image" class="absolute inset-0 bg-cover bg-center blur-lg opacity-30"></div>

    <div class="relative bg-black bg-opacity-40 p-6 rounded-lg text-center w-96">
        <h2 class="text-lg font-bold flex justify-center items-center gap-2">
            <i class="fas fa-headphones"></i> <span id="radio-name">Radio Demo</span>
        </h2>

        <div class="mt-4">
            <img id="cover-img" src="https://placehold.co/256?text=Radio+Demo" class="rounded-lg w-48 h-48 mx-auto fade">
            
        </div>

        <span class="mt-2 px-2 py-1 bg-red-600 text-sm rounded-full inline-block">AL AIRE</span>

        <h3 id="song-title" class="text-xl font-semibold mt-3 fade show">Cargando...</h3>
        <p id="artist-name" class="text-sm text-gray-400 fade show">Artista desconocido</p>
        <p id="album-info" class="text-xs text-gray-500 fade show"></p>

        <div class="flex justify-center items-center gap-6 mt-4">
            <button id="playPauseBtn" class="w-12 h-12 bg-red-500 rounded-full flex justify-center items-center text-xl">
                <i class="fas fa-play"></i>
            </button>
            <button id="shareBtn" class="w-12 h-12 bg-gray-700 rounded-full flex justify-center items-center text-xl">
                <i class="fas fa-share"></i>
            </button>
        </div>
    </div>

    <script>
        const NombreRadio = "DJ WILMER";
        const urlstream = "https://stream-175.zeno.fm/wttrxavefwzuv";
        const api_url = `https://api.f-97.com/universal?url=${urlstream}`;
        const audio = new Audio(urlstream);
        let isPlaying = false;
        let controller = new AbortController();
        let currentSong = "";

        document.getElementById("radio-name").textContent = NombreRadio;

        document.getElementById("playPauseBtn").addEventListener("click", function() {
            if (isPlaying) {
                audio.pause();
                this.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                audio.play();
                this.innerHTML = '<i class="fas fa-pause"></i>';
            }
            isPlaying = !isPlaying;
        });

        document.getElementById("shareBtn").addEventListener("click", function() {
            const shareText = `Escuchando ${currentSong || 'esta radio'} en ${NombreRadio}: ${urlstream}`;
            navigator.share ? navigator.share({ title: NombreRadio, text: shareText, url: urlstream }) : alert(shareText);
        });

        async function fetchSongInfo() {
            try {
                controller.abort();
                controller = new AbortController();

                const response = await fetch(api_url, { signal: controller.signal });
                const data = await response.json();

                const songTitle = data.songtitle || "Desconocido";
                const artist = data.artist || data.song || "Artista desconocido";
                const album = data.album ? `${data.album} (${data.year || 'Año desconocido'})` : "";
                const artwork = data.artwork || "";

                if (songTitle !== currentSong) {
                    currentSong = songTitle;

                    document.getElementById("song-title").classList.remove("show");
                    document.getElementById("artist-name").classList.remove("show");
                    document.getElementById("album-info").classList.remove("show");

                    setTimeout(() => {
                        document.getElementById("song-title").textContent = songTitle;
                        document.getElementById("artist-name").textContent = artist;
                        document.getElementById("album-info").textContent = album;

                        document.getElementById("song-title").classList.add("show");
                        document.getElementById("artist-name").classList.add("show");
                        document.getElementById("album-info").classList.add("show");
                    }, 500);
                }

                const coverImg = document.getElementById("cover-img");
                const radioLogo = document.getElementById("radio-logo");

                if (artwork) {
                    const img = new Image();
                    img.src = artwork;
                    img.onload = () => {
                        coverImg.src = artwork;
                        coverImg.classList.add("loaded");
                        radioLogo.classList.remove("loaded");
                        document.getElementById("bg-image").style.backgroundImage = `url('${artwork}')`;
                    };
                } else {
                    coverImg.classList.remove("loaded");
                    radioLogo.classList.add("loaded");
                    document.getElementById("bg-image").style.backgroundImage = "url('https://placehold.co/256?text=Radio+Demo')";
                }
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error("Error obteniendo la canción:", error);
                }
            }
        }

        setInterval(fetchSongInfo, 5000);
        fetchSongInfo();
    </script>
</body>
</html>
